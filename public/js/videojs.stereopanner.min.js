/*! videojs.stereopanner 2013-12-02
 * Author: Carlos Galan Cladera <cgcladera@gmail.com> */
videojs.AudioContext = videojs.CoreObject.extend({
    init : function() {
        try {
            window.AudioContext = window.AudioContext || window.webkitAudioContext
        } catch(a) {
            throw console.log(a), new Error(a)
        }
        this.context = new AudioContext, 
        this.context.createGain = this.context.createGain||this.context.createGainNode,
        this.gainL = this.context.createGain(), 
        this.gainR = this.context.createGain(), 
        this.gainL.gain.value = 1, 
        this.gainR.gain.value = 1, 
        this.merger = this.context.createChannelMerger(2), 
        this.splitter = this.context.createChannelSplitter(2)
    }
}), videojs.AudioContext.prototype.connect = function(a) {
    log(a);
    this.source = this.context.createMediaElementSource(a), 
    this.source.connect(this.splitter, 0, 0), 
    this.splitter.connect(this.gainL, 0), 
    this.splitter.connect(this.gainR, 1), 
    this.gainL.connect(this.merger, 0, 0), 
    this.gainR.connect(this.merger, 0, 1), 
    this.merger.connect(this.context.destination, 0, 0)
        
}, videojs.AudioContext.prototype.panToLeft = function() {
    this.gainR.disconnect(), this.gainL.connect(this.merger, 0, 0)
}, videojs.AudioContext.prototype.panToRight = function() {
    this.gainL.disconnect(), this.gainR.connect(this.merger, 0, 1)
}, videojs.AudioContext.prototype.panToStereo = function() {
    this.gainL.connect(this.merger, 0, 0), this.gainR.connect(this.merger, 0, 1)
}, videojs.Player.prototype.panToLeft = function() {
    this.ac.panToLeft()
}, videojs.Player.prototype.panToRight = function() {
    this.ac.panToRight()
}, videojs.Player.prototype.panToStereo = function() {
    this.ac.panToStereo()
}, videojs.plugin("stereopanner", function(a) {
    log(this)
    var b = this;
    b.ac = b.ac || videojs.AudioContext.create(), 
    a = a || {}, 
    b.ac.connect($(b.el()).find('video')[0]), 
    "right" === a.starting ? b.panToRight() : b.panToLeft()
}); 